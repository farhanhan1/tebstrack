<!DOCTYPE html>
<html>
<head>
    <title>Knowledge Base Test - TeBSTrack</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-box { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .question { background: #e3f2fd; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .response { background: #f1f8e9; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .status { background: #fff3e0; padding: 15px; border-radius: 6px; margin: 10px 0; }
        button { background: #4f8cff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
        button:hover { background: #3d7dff; }
        .loading { color: #666; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ TeBSTrack Knowledge Base Test</h1>
        
        <div class="test-box">
            <h2>Knowledge Base Status</h2>
            <div id="kb-status" class="status">
                <button onclick="checkKnowledgeBase()">Check Knowledge Base Status</button>
            </div>
        </div>
        
        <div class="test-box">
            <h2>Test Questions</h2>
            <p>Click any question to test if the chatbot references the knowledge base:</p>
            
            <div class="question" onclick="askQuestion('How do I reset a user VPN access?')">
                ‚ùì How do I reset a user's VPN access?
            </div>
            
            <div class="question" onclick="askQuestion('What steps should I follow for a server request?')">
                ‚ùì What steps should I follow for a server request?
            </div>
            
            <div class="question" onclick="askQuestion('How to handle laptop hardware issues?')">
                ‚ùì How to handle laptop hardware issues?
            </div>
            
            <div class="question" onclick="askQuestion('What is the procedure for M365 access requests?')">
                ‚ùì What's the procedure for M365 access requests?
            </div>
            
            <div class="question" onclick="askQuestion('How do I troubleshoot DevOps pipeline issues?')">
                ‚ùì How do I troubleshoot DevOps pipeline issues?
            </div>
            
            <div id="test-response" class="response" style="display: none;">
                <h3>AI Response:</h3>
                <div id="response-content"></div>
            </div>
        </div>
        
        <div class="test-box">
            <h2>Custom Question</h2>
            <input type="text" id="custom-question" placeholder="Ask your own question..." style="width: 70%; padding: 10px; margin-right: 10px;">
            <button onclick="askCustomQuestion()">Ask AI</button>
        </div>
    </div>

    <script>
        function checkKnowledgeBase() {
            const statusDiv = document.getElementById('kb-status');
            statusDiv.innerHTML = '<div class="loading">Checking knowledge base status...</div>';
            
            fetch('/api/ai/knowledge-status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const kb = data.knowledge_base;
                        statusDiv.innerHTML = `
                            <h3>‚úÖ Knowledge Base Status</h3>
                            <p><strong>Loaded:</strong> ${kb.loaded ? 'Yes' : 'No'}</p>
                            <p><strong>Content Length:</strong> ${kb.content_length} characters</p>
                            <p><strong>Using Document:</strong> ${kb.has_document ? 'Yes' : 'Fallback content'}</p>
                            <p><strong>Preview:</strong> ${kb.preview}</p>
                            
                            <h3>üß™ Test Response</h3>
                            <p><strong>Question:</strong> ${data.test_question}</p>
                            <p><strong>AI Answer:</strong> ${data.test_response}</p>
                        `;
                    } else {
                        statusDiv.innerHTML = `<p>‚ùå Error: ${data.error}</p>`;
                    }
                })
                .catch(error => {
                    statusDiv.innerHTML = `<p>‚ùå Failed to check status: ${error}</p>`;
                });
        }
        
        function askQuestion(question) {
            const responseDiv = document.getElementById('test-response');
            const contentDiv = document.getElementById('response-content');
            
            responseDiv.style.display = 'block';
            contentDiv.innerHTML = '<div class="loading">AI is thinking...</div>';
            
            fetch('/api/ai/chatbot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: question
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const response = data.response;
                    // Check if response references knowledge base
                    const kbIndicators = ['knowledge base', 'procedure', 'documented', 'follow these steps', 'guidelines', 'according to'];
                    const hasKbReference = kbIndicators.some(indicator => response.toLowerCase().includes(indicator));
                    
                    contentDiv.innerHTML = `
                        <p><strong>Question:</strong> ${question}</p>
                        <p><strong>Answer:</strong> ${response}</p>
                        <p><strong>References Knowledge Base:</strong> ${hasKbReference ? '‚úÖ Yes' : '‚ùå No'}</p>
                    `;
                } else {
                    contentDiv.innerHTML = `<p>‚ùå Error: ${data.response || 'Failed to get response'}</p>`;
                }
            })
            .catch(error => {
                contentDiv.innerHTML = `<p>‚ùå Failed to get response: ${error}</p>`;
            });
        }
        
        function askCustomQuestion() {
            const question = document.getElementById('custom-question').value.trim();
            if (question) {
                askQuestion(question);
            }
        }
        
        // Auto-check knowledge base status on page load
        window.onload = function() {
            checkKnowledgeBase();
        };
    </script>
</body>
</html>
